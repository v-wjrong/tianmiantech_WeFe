# 基础信息

|      |      |
|------|------|
| 名称 | wefe |
| 编码语言 | .java |
| 代码路径 | WeFe/serving/serving-service/src/main/java/com/welab/wefe |
| 包名 | docs.serving.serving-service.src.main.java.com.welab.wefe |
| 概述说明 | Config类：Spring组件，加载外部配置，定义文件路径、邮件主题等属性，支持UTF-8编码。XxxModelProcessor类：继承抽象类，空实现预处理和后处理方法。联邦学习核心API：提供加密通信、成员管理等功能，RESTful设计。预测引擎：支持联合预测，含标准、批量、调试模式。ORM层：JPA实现数据管理，含20+实体类。工具集：签名验证、加密等。枚举模块：定义服务状态和类型。隐私计算框架：处理PSI/PIR/SA请求。特征管理：统一管理数据源和模型。服务治理：全局配置和模型生命周期管理。定时任务：执行统计和状态维护。DTO管理：封装业务数据交互。日志处理：记录API日志到MySQL。启动监听器：执行初始化任务。特征处理框架：注解和SQL驱动。ServingService主类：Spring Boot应用启动配置。 |

# 说明

## 概述  
该模块是联邦学习服务系统的核心组件集合，采用微服务架构设计，核心职责包括系统配置管理、联合预测执行、数据持久化和安全通信。接口规范分层统一：配置类采用Spring属性注入（如Config），处理器类遵循模板方法模式（如XxxModelProcessor），API层继承AbstractApi基类实现RESTful交互。关键数据结构聚合为四类：系统配置（如PSI批量大小）、预测参数（如FederatedPredictParam）、持久化模型（如PredictLogMySqlModel）和枚举状态（如ServiceTypeEnum）。外部依赖去重后包含Spring生态（JPA/Cloud）、加密组件（SM2/RSA）、多数据库驱动（MySQL/Doris/Hive）及JNI调用。例如Config管理SM2密钥，PromoterPredictor协调多方预测。  

## 主要业务场景  
模块支撑联邦学习全生命周期管理，业务流程整合为：1) 系统初始化（密钥生成→配置加载→服务注册）；2) 联合预测（特征获取→安全计算→结果聚合）；3) 服务治理（日志统计→费用结算→状态跟踪）。典型交互模式类似主从架构，通过PromoterPredictor协调多节点计算，依赖签名验证框架保障通信安全。功能完整性体现在：配置中心（Config）、预测引擎（Predicter）、持久化层（Database）和服务治理（Service）的协同。例如金融风控场景中，银行通过InitializeApi初始化→调用PromoterPredictor→记录PredictLogMySqlModel→生成FeeDetailMysqlModel。API类型覆盖加密通信、成员管理、模型预测和定时任务，集成案例可见于ServingService的启动流程（加载处理器→初始化监听器→启动API服务）。


### 包内部结构视图

```mermaid
graph TD
    serving --> service
    service --> config
    service --> processor
    service --> api
    service --> predicter
    service --> database
    service --> utils
    service --> enums
    service --> service_processor
    service --> manager
    service --> scheduler
    service --> dto
    service --> operation
    service --> listener
    service --> feature
    config --> Config.java
    processor --> XxxModelProcessor.java
    api --> crypto
    api --> client
    api --> system
    api --> account
    api --> orderstatistics
    api --> partner
    api --> apirequestrecord
    api --> sa
    api --> predict
    api --> feeconfig
    api --> serviceorder
    api --> clientservice
    api --> paymentsrecords
    api --> logger
    api --> requeststatistics
    api --> service
    api --> servicecalllog
    api --> file
    api --> feedetail
    api --> pir
    api --> operation
    api --> datasource
    api --> member
    api --> model
    crypto --> GenerateRsaKeyPairApi.java
    client --> QueryClientListApi.java
    client --> UpdateApi.java
    client --> SaveClientApi.java
    client --> QueryClientApi.java
    system --> InitializeUnionModeApi.java
    system --> ResetRsaKeyApi.java
    system --> GlobalConfigUpdateApi.java
    system --> UpdateRsaKeyByBoardApi.java
    system --> InitializeApi.java
    system --> GlobalConfigDetailApi.java
    system --> IsInitializeApi.java
    account --> SsoLoginApi.java
    account --> QueryAllApi.java
    orderstatistics --> QueryListApi.java
    orderstatistics --> DownloadApi.java
    orderstatistics --> SaveApi.java
    partner --> QueryPartnerListApi.java
    partner --> SavePartnerApi.java
    partner --> UpdateApi.java
    partner --> DetailPartnerApi.java
    partner --> QueryPartnerAllApi.java
    partner --> InitPartnerApi.java
    apirequestrecord --> QueryListApi.java
    apirequestrecord --> DownloadApi.java
    sa --> SecureAggregationForResultApi.java
    predict --> deep_learning
    predict --> PredictApi.java
    predict --> DebugApi.java
    predict --> SqlConfigTestApi.java
    predict --> PromoterApi.java
    predict --> ProviderApi.java
    deep_learning --> DeepLearningPredictApi.java
    feeconfig --> SaveApi.java
    feeconfig --> QueryApi.java
    serviceorder --> QueryListApi.java
    serviceorder --> DownloadApi.java
    serviceorder --> SaveApi.java
    clientservice --> ServiceUrlTestApi.java
    clientservice --> QueryListApi.java
    clientservice --> QueryApi.java
    clientservice --> UpdateApi.java
    clientservice --> ActivateServiceApi.java
    clientservice --> DeleteActivateServiceApi.java
    clientservice --> UpdateClientServiceInfoApi.java
    clientservice --> DetailApi.java
    clientservice --> UpdateStatusApi.java
    clientservice --> SaveApi.java
    clientservice --> UpdateActivateServiceApi.java
    paymentsrecords --> QueryListApi.java
    paymentsrecords --> DownloadApi.java
    paymentsrecords --> SaveApi.java
    logger --> StatisticsApi.java
    logger --> QueryApi.java
    logger --> DateTypeEnumApi.java
    logger --> ModelListApi.java
    requeststatistics --> QueryListApi.java
    service --> QueryApi.java
    service --> RouteApi.java
    service --> UnionServiceApi.java
    service --> UpdateApi.java
    service --> QueryOneApi.java
    service --> OfflineApi.java
    service --> AddApi.java
    service --> ExportSDKApi.java
    service --> DetailApi.java
    service --> OnlineApi.java
    service --> ServiceShowSQLApi.java
    service --> InitApi.java
    service --> ServiceSQLTestApi.java
    servicecalllog --> QueryListApi.java
    file --> security
    file --> FileUploadApi.java
    file --> MergeApi.java
    security --> FileSecurityChecker.java
    feedetail --> QueryListApi.java
    pir --> PrivateInformationRetrievalForNaorPinkasResultsApi.java
    pir --> PrivateInformationRetrievalForRandomLegalApi.java
    pir --> PrivateInformationRetrievalForResultsApi.java
    pir --> PrivateInformationRetrievalForRandomApi.java
    operation --> LogQueryApi.java
    datasource --> QueryApi.java
    datasource --> QueryTablesApi.java
    datasource --> UpdateApi.java
    datasource --> DeleteApi.java
    datasource --> AddApi.java
    datasource --> TestDBConnectApi.java
    datasource --> QueryTableFieldsApi.java
    member --> QueryApi.java
    member --> DeleteApi.java
    member --> SaveApi.java
    model --> QueryApi.java
    model --> ProviderModelStatusCheckApi.java
    model --> ImportApi.java
    model --> PsiApi.java
    model --> UpdateModelApi.java
    model --> SaveModelApi.java
    model --> DetailApi.java
    model --> ModelStatusCheckApi.java
    model --> EnableApi.java
    predicter --> single
    predicter --> batch
    predicter --> Predictor.java
    single --> DebugProviderPredictor.java
    single --> PromoterPredictHelper.java
    single --> ProviderPredictor.java
    single --> DebugPromoterPredictor.java
    single --> PromoterPredictor.java
    batch --> BatchPromoterPredictor.java
    batch --> BatchProviderPredictor.java
    database --> repository
    database --> entity
    database --> config
    repository --> AccountRepository.java
    repository --> BaseServiceRepository.java
    repository --> FeeRecordRepository.java
    repository --> ClientServiceQueryRepository.java
    repository --> FeeDetailRepository.java
    repository --> ServiceOrderRepository.java
    repository --> base
    repository --> MemberRepository.java
    repository --> MessageRepository.java
    repository --> DataSourceRepository.java
    repository --> PredictStatisticsRepository.java
    repository --> ModelSqlConfigRepository.java
    repository --> TableModelRepository.java
    repository --> OperationLogRepository.java
    repository --> PaymentsRecordsRepository.java
    repository --> GlobalConfigRepository.java
    repository --> GlobalSettingRepository.java
    repository --> TableServiceRepository.java
    repository --> PredictLogRepository.java
    repository --> OrderStatisticsRepository.java
    repository --> ModelMemberRepository.java
    repository --> PartnerRepository.java
    repository --> ModelPredictScoreStatisticsRepository.java
    repository --> ClientRepository.java
    repository --> RequestStatisticsRepository.java
    repository --> PredictScoreStatisticsRepository.java
    repository --> ServiceCallLogRepository.java
    repository --> ApiRequestRecordRepository.java
    repository --> PsiServiceResultRepository.java
    repository --> FeeConfigRepository.java
    repository --> ClientServiceRepository.java
    repository --> VerificationCodeRepository.java
    repository --> ModelMemberBaseRepository.java
    repository --> ModelPredictScoreRecordRepository.java
    base --> BaseRepositoryFactoryBean.java
    base --> BaseRepositoryImpl.java
    base --> BaseRepository.java
    entity --> FeeDetailOutputModel.java
    entity --> PredictLogMySqlModel.java
    entity --> MessageMysqlModel.java
    entity --> PredictStatisticsMySqlModel.java
    entity --> GlobalSettingMySqlModel.java
    entity --> RequestStatisticsMysqlModel.java
    entity --> TableServiceMySqlModel.java
    entity --> GlobalConfigMysqlModel.java
    entity --> ClientServiceMysqlModel.java
    entity --> PsiServiceResultMysqlModel.java
    entity --> ModelSqlConfigMySqlModel.java
    entity --> AccountMySqlModel.java
    entity --> FeeConfigMysqlModel.java
    entity --> ModelPredictScoreStatisticsMySqlModel.java
    entity --> StatisticsSumModel.java
    entity --> BaseServiceMySqlModel.java
    entity --> ServiceOrderMysqlModel.java
    entity --> ModelPredictScoreRecordMySqlModel.java
    entity --> PartnerMysqlModel.java
    entity --> OperationLogMysqlModel.java
    entity --> VerificationCodeMysqlModel.java
    entity --> ServiceCallLogMysqlModel.java
    entity --> MemberMySqlModel.java
    entity --> PaymentsRecordsMysqlModel.java
    entity --> ClientServiceOutputModel.java
    entity --> AbstractBaseMySqlModel.java
    entity --> ApiRequestRecordMysqlModel.java
    entity --> ClientMysqlModel.java
    entity --> ModelMemberBaseModel.java
    entity --> FeeDetailMysqlModel.java
    entity --> DataSourceMySqlModel.java
    entity --> TableModelMySqlModel.java
    entity --> AbstractMySqlModel.java
    entity --> ModelMemberMySqlModel.java
    entity --> OrderStatisticsMysqlModel.java
    config --> DataSourceConfig.java
    utils --> deep_learning
    utils --> sign
    utils --> component
    utils --> SHA256Utils.java
    utils --> MD5Util.java
    utils --> ServiceUtil.java
    utils --> SerializeUtil.java
    utils --> ZipUtils.java
    utils --> RedisIntermediateCache.java
    utils --> ServingFileUtil.java
    utils --> SignUtils.java
    utils --> DeepLearningUtil.java
    sign --> AbstractVerifySignFunction.java
    sign --> BoardVerifySignFunction.java
    sign --> VerifySignUtil.java
    sign --> PartnerVerifySignFunction.java
    component --> ScoreCardComponentUtil.java
    enums --> DataResourceSource.java
    enums --> ServiceTypeEnum.java
    enums --> MemberModelStatusEnum.java
    enums --> DateTypeEnum.java
    enums --> ServiceOrderEnum.java
    enums --> CallByMeEnum.java
    enums --> ModelTypeEnum.java
    enums --> ServiceResultEnum.java
    enums --> PaymentsRecordStatusEnum.java
    enums --> PayTypeEnum.java
    enums --> QueryDateTypeEnum.java
    enums --> ServingModeEnum.java
    enums --> ServiceClientTypeEnum.java
    enums --> ServiceStatusEnum.java
    enums --> ClientStatusEnum.java
    enums --> ServiceCallStatusEnum.java
    enums --> PaymentsTypeEnum.java
    service_processor --> SAQueryServiceProcessor.java
    service_processor --> MultiPsiServiceProcessor.java
    service_processor --> ServiceProcessorUtils.java
    service_processor --> PirServiceProcessor.java
    service_processor --> PsiServiceProcessor.java
    service_processor --> ModelServiceProcessor.java
    service_processor --> MultiPirServiceProcessor.java
    service_processor --> AbstractServiceProcessor.java
    service_processor --> SAServiceProcessor.java
    manager --> FeatureManager.java
    manager --> JdbcManager.java
    manager --> ModelManager.java
    scheduler --> LogStatisticsScheduler.java
    scheduler --> AccountScheduledService.java
    scheduler --> OrderStatisticsScheduler.java
    scheduler --> PredictScoreStatisticsScheduler.java
    scheduler --> OrderToFeeDetailScheduler.java
    dto --> globalconfig
    dto --> ServiceOrderInput.java
    dto --> ModelSqlConfigOutput.java
    dto --> TreeNode.java
    dto --> ModelStatusOutput.java
    dto --> ServiceDetailOutput.java
    dto --> TreeNodeData.java
    dto --> OperationLogOutputModel.java
    dto --> OrderStatisticsInput.java
    dto --> FeeDetailInput.java
    dto --> BatchPredictInput.java
    dto --> AccountListAllOutputModel.java
    dto --> PagingOutput.java
    dto --> ServiceCallLogInput.java
    dto --> ServiceResultOutput.java
    dto --> MemberParams.java
    dto --> PagingInput.java
    globalconfig --> base
    globalconfig --> CaptchaSendChannelConfigModel.java
    globalconfig --> MailServerModel.java
    globalconfig --> UnionInfoModel.java
    globalconfig --> ServiceCacheConfigModel.java
    globalconfig --> GlobalConfigFlag.java
    globalconfig --> AliyunSmsConfigModel.java
    globalconfig --> GlobalConfigModel.java
    globalconfig --> IdentityInfoModel.java
    base --> AbstractConfigModel.java
    base --> GlobalConfigInput.java
    base --> ConfigModel.java
    base --> ConfigGroupConstant.java
    operation --> ServingApiLogger.java
    listener --> AutoPrivacyDatabaseEncryptListener.java
    listener --> ApplicationStartedListener.java
    feature --> code
    feature --> sql
    feature --> SqlFeatureDataHandler.java
    feature --> AbstractFeatureDataHandler.java
    feature --> CodeFeatureDataHandler.java
    code --> EmptyFeatureDataProcessor.java
    code --> FeatureProcessor.java
    code --> XxxFeatureDataProcessor.java
    code --> AbstractBatchFeatureDataProcessor.java
    code --> BatchFeatureProcessor.java
    code --> AbstractFeatureDataProcessor.java
    sql --> pg
    sql --> cassandra
    sql --> impala
    sql --> hive
    sql --> mysql
    sql --> SqlRuleUtil.java
    sql --> AbstractTemplate.java
    sql --> AbstractDruidTemplate.java
    pg --> PgSqlTemplate.java
    cassandra --> CassandraTemplate.java
    impala --> ImpalaTemplate.java
    hive --> HiveTemplate.java
    mysql --> MySqlTemplate.java
```

该流程图展示了WeFe/serving项目的完整目录结构，从顶层serving节点开始，逐级展开service、api、database等主要模块。api模块包含crypto、client、system等子模块，每个子模块下又有具体的API实现类。database模块包含repository和entity，repository下包含各种数据访问类。整体结构清晰，层级分明，完整呈现了项目的模块划分和文件组织方式。

# 文件列表

| 名称   | 类型  | 说明 |
|-------|------|-------------|
| [serving](serving/_module.md) | package | Config类：Spring组件，加载外部配置，定义文件路径、邮件主题等属性，支持UTF-8编码。XxxModelProcessor类：继承抽象类，空实现预处理和后处理方法。联邦学习核心API：提供加密通信、成员管理等功能，RESTful设计。预测引擎：支持联合预测，含标准、批量、调试模式。ORM层：JPA实现数据管理，含20+实体类。工具集：签名验证、加密等。枚举模块：定义服务状态和类型。隐私计算框架：处理PSI/PIR/SA请求。特征管理：统一管理数据源和模型。服务治理：全局配置和模型生命周期管理。定时任务：执行统计和状态维护。DTO管理：封装业务数据交互。日志处理：记录API日志到MySQL。启动监听器：执行初始化任务。特征处理框架：注解和SQL驱动。ServingService主类：Spring Boot应用启动配置。 |


